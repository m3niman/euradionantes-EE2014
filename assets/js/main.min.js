"use strict"

jQuery(document).ready(function ($) {

    // Google Analytics helper: auto-bounding output links, etc.
    var analyzer = new GoogleAnalyzer();
    analyzer.init();

    var tumblr = new Tumblr();
    tumblr.init($);
    tumblr.getData(function(data) {
        if('OK' == data.meta.msg) {
            $('section.posts').append($('<h2>').text("Tumblr :"));
            for(var i in data.response.posts) {
                $('section.posts').append($('<article>').html(data.response.posts[i].body));
            }
        }
    });


});

/**
 * Google Analytics related helper
 * Author : LesPolypodes.com
 * License : MIT
 * Disclaimer: This depends on jQuery
 */
var GoogleAnalyzer = function(){

    var outboundLinksExcludeClassName = "notAnOutbound",
        list = [],
        foo = '',
        host = document.location.host;

    var init = function() {
        list = $("a")
            .not("." + this.outboundLinksExcludeClassName)
            .not("a[href^='/']")
            .not("a[href^='mailto']")
            .not("a[href^='ftp']")
            .not("a[href^='file']")
            .not("a[href^='tel']")
            .not("a[href^='fax']")
            .not("a[href^='data']")
            .not("a[href^='javascript']")
            .not("a[href^='#']");
        $(list).on('click', trackOutboundLink);
    }

    /**
     * Send outbound event to GA server using API
     */
    var trackOutboundLink = function(ev) {
        _gaq.push(["_trackEvent", "Outgoing Links", this.href, document.location.pathname + document.location.search]);
    };

    /**
     * Exposes public methods only
     */
    return {
        init:init,
        trackOutboundLink:trackOutboundLink,
    }

}

/**
 * Tumblr API Consumer
 * Author : LesPolypodes.com
 * License : MIT
 * Disclaimer: This depends on jQuery (for $.extends(), mainly)
 */
var Tumblr = function(){

    var params = {
            key:    'JF1gaswtw9E1npDP7mtDhBfhgsdxRrhovUBIF52VPJj13hnzFZ',
            base_url:  'http://api.tumblr.com/v2/blog/euradionantes-ee2014.tumblr.com/',
            default_type: 'posts/text',
        };
    var jQuery;

    /**
     * Init function
     * @public
     */
    var init = function($) {
        jQuery = $;
    }

    var getUrl = function () {
        return params.base_url + params.default_type + '?api_key=' + params.key;
    }

    var getData = function(callBack) {
        jQuery.ajax({
            url: getUrl(),
            dataType: 'jsonp',
            success: function(data){
                return callBack(data);
            }
        });
    }

    /**
     * Exposes public methods only
     */
    return {
        init:init,
        getUrl: getUrl,
        getData: getData
    }

}
